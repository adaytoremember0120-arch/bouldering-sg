<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="„Éú„É´„ÉÄ„É™„É≥„Ç∞ SG">
    <title>„Ç∑„É≥„Ç¨„Éù„Éº„É´„Éª„Éú„É´„ÉÄ„É™„É≥„Ç∞„Ç¨„Ç§„Éâ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 5px;
        }

        .header p {
            color: #666;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            background: white;
            position: sticky;
            top: 72px;
            z-index: 99;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .tab {
            flex: 1;
            padding: 16px;
            background: white;
            border: none;
            color: #999;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .content {
            padding: 20px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }

        select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            background: white;
            transition: all 0.3s;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
        }

        select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            background-image: none;
        }

        .gym-info-panel {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
            display: none;
        }

        .gym-info-panel.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .info-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .info-row:last-child {
            margin-bottom: 0;
        }

        .info-icon {
            width: 20px;
            margin-right: 8px;
        }

        .info-label {
            font-weight: 600;
            color: #667eea;
            margin-right: 6px;
        }

        .gym-link {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 16px;
            background: #4caf50;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .grade-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px;
        }

        .grade-btn {
            padding: 16px 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1em;
            min-height: 56px;
        }

        .grade-btn:active {
            transform: scale(0.95);
        }

        .grade-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .difficulty-info {
            margin-top: 15px;
            padding: 16px;
            background: linear-gradient(135deg, #fff5e6 0%, #ffe0b2 100%);
            border-radius: 12px;
            font-size: 0.9em;
        }

        .difficulty-info strong {
            color: #f57c00;
        }

        .equivalents {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .equiv-badge {
            background: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        .climb-card {
            background: white;
            padding: 18px;
            border-radius: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .climb-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .climb-grade {
            font-size: 1.4em;
            font-weight: 700;
            color: #667eea;
        }

        .climb-date {
            color: #999;
            font-size: 0.85em;
        }

        .climb-gym {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .climb-status {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-completed {
            background: #4caf50;
            color: white;
        }

        .status-attempted {
            background: #ff9800;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.85em;
        }

        .grade-bar-container {
            margin-bottom: 16px;
        }

        .grade-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .grade-bar {
            height: 32px;
            background: #f0f0f0;
            border-radius: 16px;
            overflow: hidden;
        }

        .grade-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            padding: 0 12px;
            color: white;
            font-weight: 600;
            font-size: 0.85em;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 12px;
            font-weight: 600;
        }

        .delete-btn:active {
            transform: scale(0.95);
        }

        .section-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #333;
            margin-bottom: 16px;
            padding-left: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßó „Éú„É´„ÉÄ„É™„É≥„Ç∞ SG</h1>
            <p>„Ç∑„É≥„Ç¨„Éù„Éº„É´ÂÆåÂÖ®„Ç¨„Ç§„Éâ</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('record')">Ë®òÈå≤</button>
            <button class="tab" onclick="switchTab('history')">Â±•Ê≠¥</button>
            <button class="tab" onclick="switchTab('stats')">Áµ±Ë®à</button>
        </div>

        <div class="content">
            <!-- Ë®òÈå≤„Çø„Éñ -->
            <div id="record" class="tab-content active">
                <div class="form-group">
                    <label>„Ç∏„É†„Éñ„É©„É≥„Éâ</label>
                    <select id="gymBrand">
                        <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                        <option value="fitbloc">Fit Bloc</option>
                        <option value="bff">BFF Climb</option>
                        <option value="boulder+">Boulder+</option>
                        <option value="bouldermovement">Boulder Movement</option>
                        <option value="climbcentral">Climb Central</option>
                        <option value="boulderplanet">Boulder Planet</option>
                        <option value="kinetics">Kinetics Climbing</option>
                        <option value="groundup">Ground Up Climbing</option>
                        <option value="other">„Åù„ÅÆ‰ªñ</option>
                    </select>
                </div>

                <div class="form-group" id="locationGroup" style="display: none;">
                    <label>Â†¥ÊâÄ</label>
                    <select id="gymLocation"></select>
                    <div id="gymInfoPanel" class="gym-info-panel"></div>
                </div>
                
                <div class="form-group" id="gradeSystemGroup" style="display: none;">
                    <label>„Ç∞„É¨„Éº„Éâ„Ç∑„Çπ„ÉÜ„É†</label>
                    <select id="gradeSystem" disabled>
                        <option value="">Ëá™ÂãïÈÅ∏Êäû</option>
                    </select>
                </div>
                
                <div class="form-group" id="gradeGroup" style="display: none;">
                    <label>„Ç∞„É¨„Éº„Éâ</label>
                    <div class="grade-buttons" id="gradeButtons"></div>
                    <div id="difficultyInfo" class="difficulty-info" style="display: none;">
                        <div id="difficultyText"></div>
                        <div class="equivalents" id="equivalents"></div>
                    </div>
                </div>

                <div class="form-group" id="statusGroup" style="display: none;">
                    <label>„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                    <select id="status">
                        <option value="completed">‚úÖ ÂÆåÁôª</option>
                        <option value="attempted">üîÑ „Éà„É©„Ç§‰∏≠</option>
                    </select>
                </div>

                <div class="form-group" id="notesGroup" style="display: none;">
                    <label>„É°„É¢Ôºà‰ªªÊÑèÔºâ</label>
                    <textarea id="notes" placeholder="Ë™≤È°å„ÅÆÁâπÂæ¥„ÄÅÊÑüÊÉ≥„Å™„Å©..."></textarea>
                </div>

                <button class="btn" id="saveBtn" onclick="saveClimb()" style="display: none;">Ë®òÈå≤„Çí‰øùÂ≠ò</button>
            </div>

            <!-- Â±•Ê≠¥„Çø„Éñ -->
            <div id="history" class="tab-content">
                <div class="section-title">ÁôªÊîÄÂ±•Ê≠¥</div>
                <div id="climbsList"></div>
            </div>

            <!-- Áµ±Ë®à„Çø„Éñ -->
            <div id="stats" class="tab-content">
                <div class="section-title">Áµ±Ë®àÊÉÖÂ†±</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalClimbs">0</div>
                        <div class="stat-label">Á∑èÁôªÊîÄÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedClimbs">0</div>
                        <div class="stat-label">ÂÆåÁôªÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completionRate">0%</div>
                        <div class="stat-label">ÂÆåÁôªÁéá</div>
                    </div>
                </div>

                <div class="section-title">„Ç∞„É¨„Éº„ÉâÂà•ÂàÜÂ∏É</div>
                <div id="gradeDistribution"></div>
            </div>
        </div>
    </div>

    <script>
        // „Ç∏„É†„Éá„Éº„Çø„Éô„Éº„Çπ
        const gymDatabase = {
            fitbloc: {
                name: 'Fit Bloc',
                gradeSystem: 'fitbloc',
                locations: {
                    'Science Park': {
                        name: 'Science Park',
                        price: '$28',
                        peakHours: '18-21ÊôÇ',
                        booking: '„Ç¢„Éó„É™‰∫àÁ¥ÑÂøÖÈ†à',
                        url: 'https://www.fitbloc.com/'
                    }
                }
            },
            bff: {
                name: 'BFF Climb',
                gradeSystem: 'bff',
                locations: {
                    'Bendemeer': {
                        name: 'Bendemeer',
                        price: '$27.25',
                        peakHours: 'ÈÄ±Êú´„ÉªÂπ≥Êó•Â§ú',
                        booking: '‰∫àÁ¥ÑÊé®Â•®',
                        url: 'https://www.bffclimb.com/'
                    },
                    'Tampines': {
                        name: 'Tampines',
                        price: '$27.25',
                        peakHours: 'ÈÄ±Êú´„ÉªÂπ≥Êó•Â§ú',
                        booking: '‰∫àÁ¥ÑÊé®Â•®',
                        url: 'https://www.bffclimb.com/'
                    }
                }
            },
            'boulder+': {
                name: 'Boulder+',
                gradeSystem: 'boulder+',
                locations: {
                    'Aperia': {
                        name: 'Aperia',
                        price: '$32',
                        peakHours: 'Âπ≥Êó•Â§ú',
                        booking: '‰∫àÁ¥Ñ‰∏çË¶Å',
                        url: 'https://www.boulderplusclimbing.com/'
                    },
                    'Chevrons': {
                        name: 'Chevrons',
                        price: '$32',
                        peakHours: 'Âπ≥Êó•Â§ú',
                        booking: '‰∫àÁ¥Ñ‰∏çË¶Å',
                        url: 'https://www.boulderplusclimbing.com/'
                    }
                }
            },
            bouldermovement: {
                name: 'Boulder Movement',
                gradeSystem: 'vgrade',
                locations: {
                    'Bugis': {
                        name: 'Bugis+',
                        price: '$35',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: '„Ç¢„Éó„É™‰∫àÁ¥ÑÂøÖÈ†à',
                        url: 'https://bouldermovement.com/'
                    },
                    'Downtown': {
                        name: 'Downtown',
                        price: '$35',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: '„Ç¢„Éó„É™‰∫àÁ¥ÑÂøÖÈ†à',
                        url: 'https://bouldermovement.com/'
                    },
                    'Rochor': {
                        name: 'Rochor',
                        price: '$35',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: '„Ç¢„Éó„É™‰∫àÁ¥ÑÂøÖÈ†à',
                        url: 'https://bouldermovement.com/'
                    },
                    'Tai Seng': {
                        name: 'Tai Seng',
                        price: '$35',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: '„Ç¢„Éó„É™‰∫àÁ¥ÑÂøÖÈ†à',
                        url: 'https://bouldermovement.com/'
                    },
                    'Suntec': {
                        name: 'Suntec',
                        price: '$35',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: '„Ç¢„Éó„É™‰∫àÁ¥ÑÂøÖÈ†à',
                        url: 'https://bouldermovement.com/'
                    }
                }
            },
            climbcentral: {
                name: 'Climb Central',
                gradeSystem: 'japanese',
                locations: {
                    'Novena': {
                        name: 'Novena',
                        price: '$22-32',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: 'ÂàùÂõû„ÅÆ„Åø‰∫àÁ¥ÑÊé®Â•®',
                        url: 'https://www.climbcentral.sg/'
                    },
                    'Funan': {
                        name: 'Funan',
                        price: '$22-32',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: 'ÂàùÂõû„ÅÆ„Åø‰∫àÁ¥ÑÊé®Â•®',
                        url: 'https://www.climbcentral.sg/'
                    },
                    'Kallang': {
                        name: 'Kallang',
                        price: '$22-32',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: 'ÂàùÂõû„ÅÆ„Åø‰∫àÁ¥ÑÊé®Â•®',
                        url: 'https://www.climbcentral.sg/'
                    },
                    'i12 Katong': {
                        name: 'i12 Katong',
                        price: '$22-32',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: 'ÂàùÂõû„ÅÆ„Åø‰∫àÁ¥ÑÊé®Â•®',
                        url: 'https://www.climbcentral.sg/'
                    },
                    'SAFRA': {
                        name: 'SAFRA',
                        price: '$22-32',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: 'ÂàùÂõû„ÅÆ„Åø‰∫àÁ¥ÑÊé®Â•®',
                        url: 'https://www.climbcentral.sg/'
                    }
                }
            },
            boulderplanet: {
                name: 'Boulder Planet',
                gradeSystem: 'vgrade',
                locations: {
                    'Sembawang': {
                        name: 'Sembawang',
                        price: '$33',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: '‰∫àÁ¥Ñ‰∏çË¶Å',
                        url: 'https://www.boulderplanet.sg/'
                    },
                    'Tai Seng': {
                        name: 'Tai Seng',
                        price: '$33',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: '‰∫àÁ¥Ñ‰∏çË¶Å',
                        url: 'https://www.boulderplanet.sg/'
                    }
                }
            },
            kinetics: {
                name: 'Kinetics Climbing',
                gradeSystem: 'vgrade',
                locations: {
                    'Kinetics': {
                        name: 'Kinetics Climbing',
                        price: '$30',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: '‰∫àÁ¥ÑÊé®Â•®',
                        url: 'https://www.kineticsclimbing.com.sg/'
                    }
                }
            },
            groundup: {
                name: 'Ground Up Climbing',
                gradeSystem: 'vgrade',
                locations: {
                    'Ground Up': {
                        name: 'Ground Up Climbing',
                        price: '$28',
                        peakHours: 'Âπ≥Êó•Â§ú„ÉªÈÄ±Êú´',
                        booking: '‰∫àÁ¥Ñ‰∏çË¶Å',
                        url: 'https://www.groundupclimbing.com/'
                    }
                }
            },
            other: {
                name: '„Åù„ÅÆ‰ªñ',
                gradeSystem: 'vgrade',
                locations: {
                    'Other': {
                        name: '„Åù„ÅÆ‰ªñ„ÅÆ„Ç∏„É†',
                        price: 'ÂêÑ„Ç∏„É†„Å´„Çà„Çã',
                        peakHours: 'ÂêÑ„Ç∏„É†„Å´„Çà„Çã',
                        booking: 'ÂêÑ„Ç∏„É†„Å´„Çà„Çã',
                        url: ''
                    }
                }
            }
        };

        // „Ç∞„É¨„Éº„ÉâÂØæÊØîË°®
        const gradeMapping = {
            beginner: {
                fitbloc: ['25%'],
                bff: ['6', '7', '8'],
                'boulder+': ['Ê∞¥Ëâ≤', 'Èùí'],
                japanese: ['5Á¥ö', '4Á¥ö'],
                vgrade: ['V1', 'V2'],
                difficulty: 'Âü∫Á§é„É†„Éº„Éñ„ÅÆÁøíÂæóÊÆµÈöé'
            },
            intermediate: {
                fitbloc: ['50%'],
                bff: ['9', '10'],
                'boulder+': ['Èùí', 'Á¥´'],
                japanese: ['4Á¥ö', '3Á¥ö'],
                vgrade: ['V2', 'V3'],
                difficulty: '‰ªä„ÅÆÂêõ„ÅÆ„É°„Ç§„É≥Â±§'
            },
            advanced: {
                fitbloc: ['75%'],
                bff: ['11', '12'],
                'boulder+': ['Á∑ë'],
                japanese: ['2Á¥ö', '1Á¥ö'],
                vgrade: ['V4', 'V5'],
                difficulty: '„Åì„Åì„Åã„ÇâÊÄ•„Å´Âº∑Â∫¶„Åå‰∏ä„Åå„Çã'
            },
            expert: {
                fitbloc: ['100%'],
                bff: ['13', '14'],
                'boulder+': ['„Éî„É≥„ÇØ'],
                japanese: ['ÂàùÊÆµ‰ª•‰∏ä'],
                vgrade: ['V6', 'V7', 'V8+'],
                difficulty: 'ÊúÄÈõ£Èñ¢„ÄÇÂº∑Èù≠„Å™‰øùÊåÅÂäõ„ÅåÂøÖË¶Å'
            }
        };

        const gradeSystems = {
            fitbloc: ['25%', '50%', '75%', '100%'],
            bff: ['6', '7', '8', '9', '10', '11', '12', '13', '14'],
            'boulder+': ['Ê∞¥Ëâ≤', 'Èùí', 'Á¥´', 'Á∑ë', '„Éî„É≥„ÇØ'],
            japanese: ['5Á¥ö', '4Á¥ö', '3Á¥ö', '2Á¥ö', '1Á¥ö', 'ÂàùÊÆµ‰ª•‰∏ä'],
            vgrade: ['V0', 'V1', 'V2', 'V3', 'V4', 'V5', 'V6', 'V7', 'V8+']
        };

        let selectedGrade = null;
        let selectedGradeSystem = null;
        let selectedBrand = null;
        let selectedLocation = null;
        let climbs = [];

        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâË™≠„ÅøËæº„Åø
        function loadClimbs() {
            const saved = localStorage.getItem('sgBoulderingClimbs');
            if (saved) {
                try {
                    climbs = JSON.parse(saved);
                } catch (e) {
                    climbs = [];
                }
            }
            updateDisplay();
        }

        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
        function saveToStorage() {
            localStorage.setItem('sgBoulderingClimbs', JSON.stringify(climbs));
        }

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'history') {
                displayClimbs();
            } else if (tabName === 'stats') {
                displayStats();
            }
        }

        // „Éñ„É©„É≥„ÉâÈÅ∏ÊäûÊôÇ
        document.getElementById('gymBrand').addEventListener('change', function() {
            selectedBrand = this.value;
            const locationGroup = document.getElementById('locationGroup');
            const locationSelect = document.getElementById('gymLocation');
            
            if (!selectedBrand) {
                locationGroup.style.display = 'none';
                hideAllFormGroups();
                return;
            }

            // Â†¥ÊâÄ„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥„ÇíË®≠ÂÆö
            const brand = gymDatabase[selectedBrand];
            locationSelect.innerHTML = '<option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>';
            
            for (const [key, location] of Object.entries(brand.locations)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = location.name;
                locationSelect.appendChild(option);
            }
            
            locationGroup.style.display = 'block';
            document.getElementById('gymInfoPanel').classList.remove('show');
            hideFormGroupsAfterLocation();
        });

        // Â†¥ÊâÄÈÅ∏ÊäûÊôÇ
        document.getElementById('gymLocation').addEventListener('change', function() {
            selectedLocation = this.value;
            const infoPanel = document.getElementById('gymInfoPanel');
            
            if (!selectedLocation) {
                infoPanel.classList.remove('show');
                hideFormGroupsAfterLocation();
                return;
            }

            // „Ç∏„É†ÊÉÖÂ†±Ë°®Á§∫
            const brand = gymDatabase[selectedBrand];
            const location = brand.locations[selectedLocation];
            
            infoPanel.innerHTML = `
                <div class="info-row">
                    <span class="info-icon">üí∞</span>
                    <span class="info-label">ÊñôÈáë:</span>
                    <span>${location.price}</span>
                </div>
                <div class="info-row">
                    <span class="info-icon">‚è∞</span>
                    <span class="info-label">Ê∑∑ÈõëÊôÇÈñì:</span>
                    <span>${location.peakHours}</span>
                </div>
                <div class="info-row">
                    <span class="info-icon">üìÖ</span>
                    <span class="info-label">‰∫àÁ¥Ñ:</span>
                    <span>${location.booking}</span>
                </div>
                ${location.url ? `<a href="${location.url}" target="_blank" class="gym-link">„Ç∏„É†„ÅÆ„Çµ„Ç§„Éà„ÇíÈñã„Åè ‚Üí</a>` : ''}
            `;
            infoPanel.classList.add('show');
            
            // „Ç∞„É¨„Éº„Éâ„Ç∑„Çπ„ÉÜ„É†„ÇíËá™ÂãïË®≠ÂÆö
            selectedGradeSystem = brand.gradeSystem;
            const gradeSystemSelect = document.getElementById('gradeSystem');
            const systemNames = {
                fitbloc: 'Fit Bloc (ÂÖÖÈõª %)',
                bff: 'BFF (Êï∞Â≠ó)',
                'boulder+': 'Boulder+ (Ëâ≤)',
                japanese: 'Êó•Êú¨„ÅÆÁ¥ö',
                vgrade: 'V„Ç∞„É¨„Éº„Éâ'
            };
            gradeSystemSelect.innerHTML = `<option value="${selectedGradeSystem}">${systemNames[selectedGradeSystem]}</option>`;
            
            // „Éï„Ç©„Éº„É†Ë°®Á§∫
            document.getElementById('gradeSystemGroup').style.display = 'block';
            document.getElementById('gradeGroup').style.display = 'block';
            document.getElementById('statusGroup').style.display = 'block';
            document.getElementById('notesGroup').style.display = 'block';
            document.getElementById('saveBtn').style.display = 'block';
            
            renderGradeButtons();
        });

        function hideAllFormGroups() {
            document.getElementById('gradeSystemGroup').style.display = 'none';
            document.getElementById('gradeGroup').style.display = 'none';
            document.getElementById('statusGroup').style.display = 'none';
            document.getElementById('notesGroup').style.display = 'none';
            document.getElementById('saveBtn').style.display = 'none';
        }

        function hideFormGroupsAfterLocation() {
            document.getElementById('gradeSystemGroup').style.display = 'none';
            document.getElementById('gradeGroup').style.display = 'none';
            document.getElementById('statusGroup').style.display = 'none';
            document.getElementById('notesGroup').style.display = 'none';
            document.getElementById('saveBtn').style.display = 'none';
        }

        // „Ç∞„É¨„Éº„Éâ„Éú„Çø„É≥Ë°®Á§∫
        function renderGradeButtons() {
            const container = document.getElementById('gradeButtons');
            const grades = gradeSystems[selectedGradeSystem];
            
            container.innerHTML = grades.map(grade => 
                `<button class="grade-btn" data-grade="${grade}">${grade}</button>`
            ).join('');

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºËøΩÂä†
            document.querySelectorAll('.grade-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.grade-btn').forEach(b => {
                        b.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedGrade = this.getAttribute('data-grade');
                    showGradeInfo(selectedGrade, selectedGradeSystem);
                });
            });
        }

        // „Ç∞„É¨„Éº„ÉâÊÉÖÂ†±Ë°®Á§∫
        function showGradeInfo(grade, system) {
            const info = findGradeLevel(grade, system);
            if (!info) {
                document.getElementById('difficultyInfo').style.display = 'none';
                return;
            }

            const difficultyText = document.getElementById('difficultyText');
            const equivalents = document.getElementById('equivalents');
            
            difficultyText.innerHTML = `<strong>Èõ£ÊòìÂ∫¶Ôºö</strong>${info.difficulty}`;
            
            // ‰ªñ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅÆÂêåÁ≠â„Ç∞„É¨„Éº„ÉâË°®Á§∫
            let equivHTML = '';
            for (const [sys, grades] of Object.entries(info)) {
                if (sys !== 'difficulty' && sys !== system) {
                    const systemName = {
                        fitbloc: 'Fit Bloc',
                        bff: 'BFF',
                        'boulder+': 'Boulder+',
                        japanese: 'Êó•Êú¨',
                        vgrade: 'V'
                    }[sys];
                    equivHTML += `<span class="equiv-badge">${systemName}: ${grades.join('/')}</span>`;
                }
            }
            equivalents.innerHTML = equivHTML;
            
            document.getElementById('difficultyInfo').style.display = 'block';
        }

        // „Ç∞„É¨„Éº„Éâ„É¨„Éô„É´Ê§úÁ¥¢
        function findGradeLevel(grade, system) {
            for (const level in gradeMapping) {
                if (gradeMapping[level][system].includes(grade)) {
                    return gradeMapping[level];
                }
            }
            return null;
        }

        // Ë®òÈå≤‰øùÂ≠ò
        function saveClimb() {
            if (!selectedGrade) {
                alert('„Ç∞„É¨„Éº„Éâ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const brand = gymDatabase[selectedBrand];
            const location = brand.locations[selectedLocation];

            const climb = {
                id: Date.now(),
                brand: brand.name,
                location: location.name,
                gradeSystem: selectedGradeSystem,
                grade: selectedGrade,
                status: document.getElementById('status').value,
                notes: document.getElementById('notes').value,
                date: new Date().toISOString()
            };

            climbs.unshift(climb);
            saveToStorage();
            
            // „Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.grade-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            selectedGrade = null;
            document.getElementById('notes').value = '';
            document.getElementById('difficultyInfo').style.display = 'none';
            
            alert('‚úÖ Ë®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
            updateDisplay();
        }

        // Ë®òÈå≤ÂâäÈô§
        function deleteClimb(id) {
            if (confirm('„Åì„ÅÆË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                climbs = climbs.filter(climb => climb.id !== id);
                saveToStorage();
                displayClimbs();
                displayStats();
            }
        }

        // Â±•Ê≠¥Ë°®Á§∫
        function displayClimbs() {
            const container = document.getElementById('climbsList');
            
            if (climbs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <p>„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                        <p style="font-size: 0.9em; margin-top: 10px; color: #999;">„ÄåË®òÈå≤„Äç„Çø„Éñ„Åã„ÇâÁôªÊîÄ„ÇíË®òÈå≤„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = climbs.map(climb => {
                const date = new Date(climb.date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                const statusClass = climb.status === 'completed' ? 'status-completed' : 'status-attempted';
                const statusText = climb.status === 'completed' ? '‚úÖ ÂÆåÁôª' : 'üîÑ „Éà„É©„Ç§‰∏≠';
                
                const systemName = {
                    fitbloc: 'Fit Bloc',
                    bff: 'BFF',
                    'boulder+': 'Boulder+',
                    japanese: 'Êó•Êú¨',
                    vgrade: 'V'
                }[climb.gradeSystem] || climb.gradeSystem;
                
                return `
                    <div class="climb-card">
                        <div class="climb-header">
                            <div class="climb-grade">${climb.grade} (${systemName})</div>
                            <div class="climb-date">${dateStr}</div>
                        </div>
                        <div class="climb-gym">üìç ${climb.brand} - ${climb.location}</div>
                        <div style="margin-bottom: 10px;">
                            <span class="climb-status ${statusClass}">${statusText}</span>
                        </div>
                        ${climb.notes ? `<p style="color: #666; margin-top: 10px; font-size: 0.9em;">${climb.notes}</p>` : ''}
                        <button class="delete-btn" onclick="deleteClimb(${climb.id})">ÂâäÈô§</button>
                    </div>
                `;
            }).join('');
        }

        // Áµ±Ë®àË°®Á§∫
        function displayStats() {
            const total = climbs.length;
            const completed = climbs.filter(c => c.status === 'completed').length;
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('totalClimbs').textContent = total;
            document.getElementById('completedClimbs').textContent = completed;
            document.getElementById('completionRate').textContent = rate + '%';

            // „Ç∞„É¨„Éº„ÉâÂàÜÂ∏É
            const allGrades = {};
            climbs.forEach(climb => {
                const key = `${climb.grade} (${climb.gradeSystem})`;
                allGrades[key] = (allGrades[key] || 0) + 1;
            });

            const maxCount = Math.max(...Object.values(allGrades), 1);
            const container = document.getElementById('gradeDistribution');
            
            const sortedGrades = Object.entries(allGrades).sort((a, b) => b[1] - a[1]);
            
            if (sortedGrades.length === 0) {
                container.innerHTML = '<div class="empty-state"><p style="color: #999;">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p></div>';
                return;
            }

            container.innerHTML = sortedGrades.map(([grade, count]) => {
                const percentage = maxCount > 0 ? (count / maxCount) * 100 : 0;
                
                return `
                    <div class="grade-bar-container">
                        <div class="grade-bar-label">
                            <span>${grade}</span>
                            <span>${count}Âõû</span>
                        </div>
                        <div class="grade-bar">
                            <div class="grade-bar-fill" style="width: ${percentage}%">
                                ${count > 0 ? count + 'Âõû' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateDisplay() {
            displayClimbs();
            displayStats();
        }

        // ÂàùÊúüÂåñ
        loadClimbs();
    </script>
</body>
</html>